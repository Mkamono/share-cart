version: "3"

interval: 50ms

includes:
  dep: taskfiles/dependency.yaml

tasks:
  dev:
    deps:
      - generate
      - gen_env
      - dep_graph
      - format

  generate:
    cmd: bunx -y openapi-typescript ../api/docs/openapi/schema/root.yaml -o share-cart/app/models/schema.d.ts
    sources:
      - "../api/docs/openapi/schema/root.yaml"
    generates:
      - "share-cart/app/models/schema.d.ts"

  format:
    dir: share-cart/app
    cmds:
      - bunx biome format --write
    sources:
      - "**/*.tsx"
      - "**/*.ts"
      - "!**/schema.d.ts"

  gen_env:
    cmd: bunx gen-env-template .env .env.example
    sources:
      - ".env"
    generates:
      - ".env.example"

  dep_graph:
    deps: [dep:graphviz]
    dir: share-cart
    cmd: bunx depcruise app --include-only "^app" --output-type dot | dot -Tpng > dependency-graph.png # cspell: disable-line
    sources:
      - "app/**/*.ts"
      - "app/**/*.tsx"
    generates:
      - "dependency-graph.png"
